---
layout:     post
title:      "前期数据处理"
subtitle:
date:       2017-02-22 19:00:00
author:     "随机漫步的傻瓜"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - 机器学习
---

# 前期数据处理

## 1.数据挖掘的准备

### 1.1变量定义
- 最先定义因变量和自变量，然后定义数据类型（数值、文本等）和变量的种类（连续，离散）

### 1.2单变量分析
- 连续变量：理解集中趋势和集中程度，可以使用常见的平均数、中位数、众数、分位点、标准差等
- 离散变量：用频率去理解每个分类的分布，用柱状图进行可视化,处理离散变量通常有两步：把属性变量转变为标签，把标签转变为二元数值

### 1.3二维变量分析
二维变量分析找出两个变量之间的关系
- 连续变量与连续变量：可以利用散点图判断相关性，利用相关系数判断相关强度
- 离散变量与离散变量：可以看频数表，也可以用卡方检验检验关联性
- 离散变量与连续变量：可以使用Z检验或者T检验，检验不同类别的平均值是否不同

## 2.缺失值的处理
- 缺失值较多的特征可以考虑去除
- 缺失值较少的特征可以考虑：1.把NaN直接作为一个特征，假设用0表示；2.用平均值、中位数、众数填充；3.用上下数据进行填充；4.用插值法填充；5.用算法拟合进行填充（比如用KNN算法填充）；
- 有时不去补充缺失值，模型反而会有更好的表现

## 3.异常值的处理
- 运用可视化，异常值经验法则如下：盒图：超过正负1.5极差为异常值；限制方法：在5%-95%以外的数据为异常值；数据点：数据与平均值的差值三倍或更多时为异常值；业务逻辑：对业务了解；公式算法：二维变量或多维变量经常用指数影响或者距离影响。例如马氏距离和Cook距离

## 4.特征工程

### 4.1变量转化
- 数据模型中，转化是指用平方/立方根或者对数等公式算法替代原数据，或者说转化就是改变变量与其他变量的分布或者关系
- 1）当为了更好理解变量而改变其单位或者标准。当数据单位不同时，这个转换是必须的，此时的转化不会改变变量间的分布情况;2）把复杂非线性的关系转化线性关系，散点图可以展示连续型变量的关系，对数转化是最常用的手法;3）对称分布好于有偏分布：当数据右偏，用平方/立方根或者对数方法；当数据左偏，用平方，开方或者指数方法。
- 对数：通常用在右偏数据中，但不能处理0和负值;平方/立方根：有效的影响分布，但没有对数显著，立方根处理负数占有优势;分组：针对类别型变量，对原始百分比或频率。分组基于对业务的了解。例如，可以把收入分为高、中、低。
- 连续值处理为二值特征方法：先将连续值离散化（后面会介绍如何离散化)，再将离散化后的特征切分为N个二元特征，每个特征代表是否在这个区间内。

### 4.2构造变量
- 生成衍生变量：用公式或者其他方法创建新变量；最近，频率，均值，方差，各种比值
- 生成虚拟变量：最常见的是把类别型变量转化为数值型变量

### 4.3 归一化
不同的特征有不同的取值范围，在有些算法中，例如线性模型或者距离相关的模型像聚类模型、knn模型等，特征的取值范围会对最终的结果产生较大影响，例如二元特征的取值范围为[0，1]，而距离特征取值可能是[0，正无穷)，在实际使用中会对距离进行截断，例如[0，3000000]，但是这两个特征由于取值范围不一致导致了模型可能会更偏向于取值范围较大的特征，为了平衡取值范围不一致的特征，需要对特征进行归一化处理，将特征取值归一化到［0，1］区间。常用的归一化方法包括1.函数归一化，通过映射函数将特征取值映射到［0，1］区间，例如最大最小值归一化方法，是一种线性的映射。还有通过非线性函数的映射，例如log函数等。2.分维度归一化，可以使用最大最小归一化方法，但是最大最小值选取的是所属类别的最大最小值，即使用的是局部最大最小值，不是全局的最大最小值。3.排序归一化，不管原来的特征取值是什么样的，将特征按大小排序，根据特征所对应的序给予一个新的值。

### 4.4离散化
在上面介绍过连续值的取值空间可能是无穷的，为了便于表示和在模型中处理，需要对连续值特征进行离散化处理。
常用的离散化方法包括等值划分和等量划分。
- 等值划分是将特征按照值域进行均分，每一段内的取值等同处理。例如某个特征的取值范围为[0，10]，我们可以将其划分为10段，[0，1)，[1，2)，...，[9，10)。
- 等量划分是根据样本总数进行均分，每段等量个样本划分为1段。例如距离特征，取值范围［0，3000000］，现在需要切分成10段，如果按照等比例划分的话，会发现绝大部分样本都在第1段中。使用等量划分就会避免这种问题，最终可能的切分是[0，100)，[100，300)，[300，500)，..，[10000，3000000]，前面的区间划分比较密，后面的比较稀疏。
